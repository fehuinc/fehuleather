<%= render "wholesales/button_bar" %>

<div class="top">
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="20 40 160 140">
    <defs>
      <path id="svg-circle" d="M25, 100 a75,75 0 1,0 150,0 a75,75 0 1,0 -150,0"/>
      <clipPath id="clip-path"><path d="M40, 100 a60,60 0 1,1 120,0 a60,60 0 1,1 -120,0"/></clipPath>
    </defs>
    <image x="40" y="40" width="120" height="120" xlink:href="<%=@product.totem_image%>" clip-path='url(#clip-path)' />
    <text x="0" y="0" fill="#456" fill-opacity="1" transform="rotate(<%=-90 + @product.name.length*3%>, 100, 100)">
      <textPath xlink:href="#svg-circle"><%= @product.name %></textPath>
    </text>
  </svg>
  
  <div class="info">
    <% @product.infos.each do |info| %>
      <h3><%= info.name %></h3>
      <p><%= info.content %></p>
    <% end %>
  </div>
</div>

<div class="split">
    
  <wholesale-builder>
    <h1>Add to Your Order</h1>
    
    <table>
      <thead class="glass" sticky="0">
        <% @product.variations.order(:level).each_with_index do |variation, index| %>
          <td <%= "default=true" if index == 0 %>><a><%= variation.name %></a></td>
        <% end %>
        <td>Preview</td>
        <td><a>Quantity</a></td>
      </thead>
      <tbody>
        <% @builds.each do |build| %>
          <tr>
            <% build.variants.joins(:variation).order("variations.level").each do |variant| %>
              <td sort-value='<%= "#{variant.sort_order.to_s}_#{variant.name}" %>'>
                <%= variant.name %>
              </td>
            <% end %>
            <td class="preview">
              <img src="<%=build.image('wholesale')%>">
            </td>
            <td>
              <div class="quantity" item-editor>
                <span ng-init="editorItem.build_id=<%=build.id%>"></span>
                <span ng-init="editorItem.name='<%=build.name%>'"></span>
                <span ng-init="editorItem.cents=<%=build.cents_wholesale%>"></span>
                <span ng-init="editorItem.image='<%=build.image('wholesale')%>'"></span>
                <span ng-init="setQuantity(<%= current_order_quantity(@order, build) %>)"></span>
                <div class="button-row perspective">
                  <div class="button" ng-click="changeQuantity(-1)">-</div>
                  <div class="button" ng-click="changeQuantity(1)">+</div>
                  <div class="button five" ng-click="changeQuantity(5)">+5</div>
                </div>
                <div class="input-row">
                  <input type="number"
                         class="quantity input-no-spinner"
                         ng-model="editorItem.displayQuantity"
                         ng-change="setQuantity(editorItem.displayQuantity)">
                </div>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  
  </wholesale-builder>
  
  <div>
    <%= render "wholesales/wholesale_preview" %>
  </div>
</div>

<%= render "wholesales/button_bar" %>
