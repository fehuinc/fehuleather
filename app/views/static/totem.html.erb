<script>
  TOTEM_IMAGES = {}
</script>

<% @products.each do |product| %>
  <script>
    TOTEM_IMAGES["<%=raw product.name%>"] = [
      "<%= raw product.variations.first.variants.map(&:totem_image).join('","') %>"
    ]
  </script>
  
  <div class="product">
    <div class="container">
      <div class="slider" product-name="<%=raw product.name%>"></div>
    </div>
    
    <div class="product-info">
      <div class="wrapper">
        <h1>{{product.name}}</h1>

        <purchasing-info>
          <div class="variations">
            <div class="variation" ng-repeat="variation in product.variations">
              <label>
                {{variation.name}}
              </label>
              <select ng-model="variation.choiceIndex" ng-change="checkChange($index)" ng-options="index*1 as variant.name for (index, variant) in variation.variants"></select>
            </div>
          </div>
          <div class="subtotal">
            <input class="quantity" type="number" step="1" min="0" max="99" ng-model="product.quantity">
            for
            <div class="price">${{choicePrice()}}</div>
          </div>
          
          <div class="perspective submit" ng-hide="isInCart(product)">
            <button ng-click="addToCart(product)">Yes Please!</button>
          </div>
          
          <div class="perspective submit" ng-show="isInCart(product) && (product.quantity != getQuantity(product))">
            <button ng-click="addToCart(product)">Update Quantity</button>
          </div>
          
          <div class="cart" ng-show="isInCart(product) && (product.quantity == getQuantity(product))">
            <div>{{product.quantity == 1 ? "It's" : "They're" }} in <a ng-click="showCart()">The Bag</a></div>
          </div>
        </purchasing-info>

        <descriptive-info>
          <div ng-bind-html="specimen.description"></div>
        </descriptive-info>
        
        
        <bottom-info>
          <custom-info>
            <div ng-repeat="info in product.infos"
                 ng-click="showInfo(info)"
                 ng-class="{active:(info == showingInfo)}">{{info.name}}</div>
          </custom-info>
          <shop-info>
            <div ng-repeat="info in shopInfos"
                 ng-click="showInfo(info)"
                 ng-class="{active:(info == showingInfo)}">{{info.name}}</div>
          </shop-info>
          <info-display ng-show="showingInfo">
            <div>{{showingInfo.content}}</div>
          </info-display>
        </bottom-info>
        
        <a class="closer" ng-click="close()">Close</a>
      </div>
    </div>
  </div>
<% end %>
