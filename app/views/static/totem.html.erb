<script>
  FEHU.totemProducts = <%= @totem_products.html_safe %>
  FEHU.shopInfo = <%= @shop_info.html_safe %>
</script>

<h1 ng-hide="true">Loading</h1>

<div ng-cloak ng-controller="TotemCtrl">
  <totem-product ng-repeat="product in products"
                 ng-class="{showingPanel:isPanelOpen(product)}">
    <div class="overflow-container">
      <totem-specimens-list ng-style="getListPositionStyle()"
                            ng-mousemove="mouseMove($event)">
        <totem-specimen ng-repeat="specimen in product.specimens"
                        ng-style="getSpecimenStyle()"
                        ng-click="clickSpecimen(product, $index)">
          <div bimg="{{specimen.totem}}"></div>
        </totem-specimen>
      </totem-specimens-list>
    </div>
    
    <totem-product-panel>
      <div class="wrapper">
        <h1>{{product.name}}</h1>
        <p>We'll soon be offering this product for sale, right here. Check back in February!</p>
        <% if false %>
        <purchasing-info>
          <div class="variations">
            <div class="variation" ng-repeat="variation in product.variations">
              <label>
                {{variation.name}}
              </label>
              <select ng-model="variation.choiceIndex"
                      ng-change="checkChange($index, variation)"
                      ng-options="index*1 as variant.name for (index, variant) in variation.variants">
              </select>
            </div>
          </div>
          <div class="subtotal">
            <div class="input-with-buttons">
              <div class="button-row perspective">
                <div class="button" ng-click="changeQuantity(-1)">-</div>
                <div class="button" ng-click="changeQuantity(1)">+</div>
              </div>
              <input type="number"
                     class="quantity"
                     step="1"
                     ng-model="currentBuild.desiredQuantity">
            </div>
            for
            <div class="price">${{currentBuild.desiredQuantity * currentBuild.cents_retail / 100}}</div>
          </div>
          
          <div class="perspective submit" ng-hide="Cart.has(currentBuild)">
            <button ng-click="Cart.add(currentBuild)">Yes Please!</button>
          </div>
          
          <div class="perspective submit"
               ng-show="Cart.has(currentBuild) && (currentBuild.desiredQuantity != Cart.get(currentBuild).quantity)">
            <button ng-click="Cart.add(currentBuild)">Update Quantity</button>
          </div>
          
          <div class="cart"
               ng-show="Cart.has(currentBuild) && (currentBuild.desiredQuantity == Cart.get(currentBuild).quantity)">
            <div>{{product.quantity == 1 ? "It's" : "They're" }} in <a ng-click="showCart()">The Bag</a></div>
          </div>
        </purchasing-info>

        <descriptive-info>
          <div ng-bind-html="specimen.description"></div>
        </descriptive-info>
        
        
        <bottom-info>
          <custom-info>
            <div ng-repeat="info in product.infos"
                 ng-click="toggleInfo(info)"
                 ng-class="{active:isInfoOpen(info)}">{{info.name}}</div>
          </custom-info>
          <shop-info>
            <div ng-repeat="info in shopInfo"
                 ng-click="toggleInfo(info)"
                 ng-class="{active:isInfoOpen(info)}">{{info.name}}</div>
          </shop-info>
          <info-display ng-show="showingInfo">
            <div>{{showingInfo.content}}</div>
          </info-display>
        </bottom-info>
        <% end %>
        <a class="closer" ng-click="closePanel()">Close</a>
      </div>
    </totem-product-panel>
  </totem-product>
</div>
